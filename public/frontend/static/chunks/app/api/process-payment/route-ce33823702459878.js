(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9588],{2737:(e,t,r)=>{"use strict";r.r(t),r.d(t,{POST:()=>o});var a=r(8102),s=r(85254),n=r(49509),c=r(49641).Buffer;async function o(e){try{let{paymentMethod:t,amount:r,currency:s,items:n,customerInfo:c,merchantAccount:o,card:u,paypalOrderId:m,provider:f}=await e.json();if(!t||!r||!s)return a.NextResponse.json({success:!1,error:"Missing required payment information"},{status:400});let h={success:!1,transactionId:"",error:""};switch(t){case"visa":case"mastercard":h=await i({amount:r,currency:s,card:u,customerInfo:c,items:n,merchantAccount:o});break;case"paypal":h=await l({amount:r,currency:s,paypalOrderId:m,customerInfo:c,items:n,merchantAccount:o});break;case"applepay":h=await d({amount:r,currency:s,customerInfo:c,items:n,merchantAccount:o});break;case"googlepay":h=await p({amount:r,currency:s,customerInfo:c,items:n,merchantAccount:o});break;case"cash":h=await y({amount:r,currency:s,customerInfo:c,items:n,merchantAccount:o});break;default:return a.NextResponse.json({success:!1,error:"Unsupported payment method"},{status:400})}if(h.success)return console.log("Payment processed successfully: ".concat(h.transactionId)),a.NextResponse.json({success:!0,transactionId:h.transactionId,message:"Payment processed successfully"});return a.NextResponse.json({success:!1,error:h.error||"Payment processing failed"},{status:400})}catch(e){return console.error("Payment processing error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function i(e){let{amount:t,currency:r,card:a,customerInfo:c,items:o,merchantAccount:i}=e;try{var u;let e=n.env.STRIPE_SECRET_KEY||(u=0,null);if(!e)throw Error("Stripe secret key not configured");let a=new s.A(e),l=await a.paymentIntents.create({amount:Math.round(100*t),currency:r.toLowerCase(),automatic_payment_methods:{enabled:!0},metadata:{merchantAccount:i,customerEmail:c.email,items:JSON.stringify(o.map(e=>({name:e.item.name,price:e.price,quantity:1})))}});if("succeeded"===l.status)return{success:!0,transactionId:l.id,error:""};return{success:!1,transactionId:"",error:"Payment failed: ".concat(l.status)}}catch(e){return console.error("Stripe payment error:",e),{success:!1,transactionId:"",error:e.message||"Stripe payment failed"}}}function u(){return"https://api.paypal.com"}async function l(e){let{amount:t,currency:r,paypalOrderId:a,customerInfo:s,items:o,merchantAccount:i}=e;try{let e=n.env.PAYPAL_CLIENT_ID||null,t=n.env.PAYPAL_CLIENT_SECRET||null;if(!e||!t)throw Error("PayPal credentials not configured");let r=c.from("".concat(e,":").concat(t)).toString("base64"),s=await fetch("".concat(u(),"/v1/oauth2/token"),{method:"POST",headers:{Authorization:"Basic ".concat(r),"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=client_credentials"}),o=(await s.json()).access_token,i=await fetch("".concat(u(),"/v2/checkout/orders/").concat(a,"/capture"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}}),l=await i.json();if("COMPLETED"===l.status)return{success:!0,transactionId:l.id,error:""};return{success:!1,transactionId:"",error:"PayPal payment failed: ".concat(l.status)}}catch(e){return console.error("PayPal payment error:",e),{success:!1,transactionId:"",error:e.message||"PayPal payment failed"}}}async function d(e){let{amount:t,currency:r,customerInfo:a,items:s,merchantAccount:n}=e;try{let e="apple_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));return{success:!0,transactionId:e,error:""}}catch(e){return{success:!1,transactionId:"",error:e.message||"Apple Pay payment failed"}}}async function p(e){let{amount:t,currency:r,customerInfo:a,items:s,merchantAccount:n}=e;try{let e="google_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));return{success:!0,transactionId:e,error:""}}catch(e){return{success:!1,transactionId:"",error:e.message||"Google Pay payment failed"}}}async function y(e){let{amount:t,currency:r,customerInfo:a,items:s,merchantAccount:n}=e;try{let e="cash_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));return console.log("Cash order recorded: ".concat(e," for $").concat(t)),{success:!0,transactionId:e,error:""}}catch(e){return{success:!1,transactionId:"",error:e.message||"Cash payment recording failed"}}}},42634:()=>{},56426:(e,t,r)=>{Promise.resolve().then(r.bind(r,2737))}},e=>{var t=t=>e(e.s=t);e.O(0,[9641,4869,8441,1684,7358],()=>t(56426)),_N_E=e.O()}]);